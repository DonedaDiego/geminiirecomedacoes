<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geminii Tecnologia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: '#000000',
            light: '#ffffff',
            subtle: 'rgba(255,255,255,0.1)',
            geminii: '#ba39af'
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif']
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      overflow-x: hidden;
    }

    /* ===== CARROSSEL STYLES ===== */
    .market-carousel {
      width: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 40;
      position: relative;
      margin-bottom: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* ✅ CORRETO */
    footer {
      padding-top: 20px !important;
    }
    .carousel-container {
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
      position: relative;
      height: 180px;
      padding: 3px 0;
    }
    
    .carousel-track {
      display: inline-flex;
      animation: scroll 60s linear infinite;
      gap: 24px;
      padding: 0 24px;
    }

    .carousel-track:hover {
      animation-play-state: paused;
    }

    @keyframes scroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(-50%);
      }
    }

    .stock-item {
      flex-shrink: 0;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 200px;
      transition: all 0.3s ease;
      cursor: pointer;
      backdrop-filter: blur(10px);
    }

    .stock-item:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(186, 57, 175, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(186, 57, 175, 0.2);
    }

    .stock-positive {
      border-color: rgba(16, 185, 129, 0.3);
    }

    .stock-negative {
      border-color: rgba(239, 68, 68, 0.3);
    }

    .stock-neutral {
      border-color: rgba(156, 163, 175, 0.3);
    }

    /* ===== ESCONDER MARKET SUMMARY ===== */
    .market-summary {
      display: none !important;
    }

    .loading-carousel {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 60px;
      gap: 8px;
      color: rgba(255, 255, 255, 0.6);
    }

    .loading-dot {
      width: 6px;
      height: 6px;
      background: #ba39af;
      border-radius: 50%;
      animation: loading-pulse 1.5s ease-in-out infinite;
    }

    .loading-dot:nth-child(2) { animation-delay: 0.2s; }
    .loading-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes loading-pulse {
      0%, 80%, 100% {
        opacity: 0.3;
        transform: scale(0.8);
      }
      40% {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Neon Logo Effect */
    .neon-logo {
      transition: all 0.3s ease;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .neon-logo:hover {
      filter: 
        drop-shadow(0 0 5px #ba39af)
        drop-shadow(0 0 10px #ba39af)
        drop-shadow(0 0 15px #ba39af)
        drop-shadow(0 0 20px #ba39af)
        brightness(1.2);
      transform: scale(1.1);
    }

    /* Navbar Effects */
    nav:hover {
      background: rgba(186, 57, 175, 0.05);
      border-color: rgba(186, 57, 175, 0.3);
      box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 20px rgba(186, 57, 175, 0.2),
        0 0 40px rgba(186, 57, 175, 0.1);
      transition: all 0.3s ease;
    }

    nav a:hover {
      color: #ba39af;
      text-shadow: 
        0 0 5px #ba39af,
        0 0 10px #ba39af,
        0 0 15px #ba39af;
      transition: all 0.3s ease;
    }

    /* ===== NAVBAR VOLTOU PARA POSIÇÃO ORIGINAL ===== */
    .main-navbar {
      position: fixed;
      top: 6px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 45;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 9999px;
      padding: 16px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(20px);
    }

    /* User Menu Styles */
    .user-menu {
      position: relative;
      display: inline-block;
    }

    .user-menu-dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      min-width: 200px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      margin-top: 8px;
      padding: 8px;
    }

    .user-menu.active .user-menu-dropdown {
      display: block;
    }

    .user-menu-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      color: #333;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .user-menu-item:hover {
      background: rgba(186, 57, 175, 0.1);
      color: #ba39af;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ba39af, #d946ef);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgba(186, 57, 175, 0.5);
    }

    .plan-badge {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: 2px 6px;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 600;
      text-transform: uppercase;
      margin-left: 4px;
    }

    .plan-badge.premium {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }

    .plan-badge.strategic {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    }

    /* Hero Title Styles */
    .hero-title {
      font-size: clamp(2rem, 6vw, 4.5rem);
      line-height: 1.1;
      font-weight: 900;
    }

    .hero-subtitle {
      font-size: clamp(1rem, 3vw, 2rem);
      font-weight: 300;
      line-height: 1.2;
    }

    .hero-description {
      font-size: clamp(1rem, 2vw, 1.25rem);
      line-height: 1.6;
    }

    /* Geminii Text Hover Effect */
    .geminii-text {
      color: #ba39af;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .geminii-text:hover {
      text-shadow: 
        0 0 30px rgba(186, 57, 175, 1),
        0 0 60px rgba(186, 57, 175, 0.8),
        0 4px 20px rgba(0, 0, 0, 0.9);
    }

    /* CTA Button Styles */
    .auth-btn {
      background: linear-gradient(135deg, #ba39af, #d946ef);
      color: white;
      border: none;
      transition: all 0.3s ease;
      font-size: clamp(0.875rem, 1.5vw, 1.125rem);
      padding: clamp(12px, 2vw, 16px) clamp(24px, 4vw, 40px);
      text-decoration: none;
      display: inline-block;
    }

    .auth-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(186, 57, 175, 0.3);
    }

    .dashboard-btn {
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.5);
      color: #10b981;
      font-size: clamp(0.875rem, 1.5vw, 1.125rem);
      padding: clamp(12px, 2vw, 16px) clamp(24px, 4vw, 40px);
      text-decoration: none;
      display: inline-block;
    }

    .dashboard-btn:hover {
      background: rgba(16, 185, 129, 0.3);
      color: white;
    }

    /* Login Button */
    .login-btn {
      background: white;
      color: black;
      border: none;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    .login-btn:hover {
      background: #f3f4f6;
      transform: translateY(-1px);
    }

    /* Footer Styles */
    .newsletter-input:focus {
      border-color: #ba39af;
      box-shadow: 
        0 0 10px rgba(186, 57, 175, 0.3),
        0 0 20px rgba(186, 57, 175, 0.1);
    }

    .newsletter-btn:hover {
      box-shadow: 
        0 10px 25px -5px rgba(0, 0, 0, 0.1),
        0 0 15px rgba(186, 57, 175, 0.2);
    }

    .social-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255, 255, 255, 0.7);
      font-size: 20px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .social-icon:hover {
      color: #ba39af;
      border-color: #ba39af;
      background: rgba(186, 57, 175, 0.1);
      box-shadow: 
        0 0 15px rgba(186, 57, 175, 0.3),
        0 0 30px rgba(186, 57, 175, 0.1);
      transform: translateY(-3px) scale(1.1);
    }

    .footer-link {
      color: rgba(255, 255, 255, 0.6);
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    

    .footer-link:hover {
      color: #ba39af;
      text-shadow: 0 0 8px rgba(186, 57, 175, 0.5);
    }

    /* ===== HERO SECTION NORMAL ===== */
    .hero-section {
      padding-top: 100px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .main-navbar {
        top: 0px;
      }
      
      .market-carousel {
        margin-bottom: 50px;
      }
      
      .carousel-container {
        height: 120px;
        padding: 5px 0;
      }
      
      .stock-item {
        min-width: 160px;
        padding: 8px 12px;
      }
      
      .market-summary {
        display: none !important;
      }
      
      .hero-section {
        padding-top: 140px;
      }
      
      .hero-title {
        text-align: center;
      }
      
      .hero-subtitle {
        text-align: center;
      }
      
      .hero-description {
        text-align: center;
      }
      
      nav .hidden.md\\:flex {
        display: none !important;
      }
    }
</style>
</head>
<body class="bg-black text-white font-sans">
  <div class="relative min-h-screen overflow-hidden">
    
    

    <!-- Spline 3D background -->
    <div class="fixed inset-0 z-0">
      <iframe src="https://my.spline.design/thresholddarkambientui-v0gkZCfi6zXm69kE0wccy70f/" frameborder="0" width="100%" height="100%" class="w-full h-full"></iframe>
    </div>
    
    <!-- Glass floating navbar -->
    <nav class="main-navbar bg-opacity-5 border-opacity-10 bg-white border-white border rounded-full pt-4 pr-4 pb-4 pl-4 shadow-xl backdrop-blur-md">
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <!-- Logo -->
          <img src="assets/logo.png" alt="Geminii Logo" class="w-6 h-6 neon-logo" onclick="navigateHome()" onerror="this.src='/assets/logo.png'; this.onerror=null;">
        </div>
        
        <!-- Simple Menu -->
        <div class="hidden md:flex items-center space-x-6 text-xs text-gray-300 ml-8">
          <a href="/planos" class="hover:text-white transition-colors">Planos</a>
          <a href="/sobre" class="hover:text-white transition-colors">Sobre</a>
        </div>
        
        <!-- Auth Section -->
        <div class="flex items-center space-x-3 ml-8">
          <div id="apiStatus" class="w-8 h-8 bg-green-500 bg-opacity-10 border border-green-500 border-opacity-30 rounded-full flex items-center justify-center relative">
            <i class="fas fa-shield-alt text-green-500 text-xs"></i>
            <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          </div>
          
          <!-- Guest View -->
          <div id="guestView" class="flex items-center space-x-2">
            <a href="/login.html" class="login-btn hover:bg-gray-200 transition-colors text-xs font-medium rounded-full pt-1.5 pr-3 pb-1.5 pl-3">Login</a>
          </div>
          
          <!-- User View -->
          <div id="userView" class="user-menu hidden">
            <div class="user-avatar" onclick="toggleUserMenu()">
              <span id="userInitials">GU</span>
            </div>
            <div class="user-menu-dropdown" id="userMenuDropdown">
              <div class="px-3 py-2 border-b border-gray-200">
                <p class="text-sm font-medium text-gray-900" id="userName">Usuário</p>
                <p class="text-xs text-gray-500" id="userEmail">email@example.com</p>
                <p class="text-xs text-gray-500">
                  Plano: <span id="userPlan" class="font-medium">Básico</span>
                  <span id="planBadge" class="plan-badge">Free</span>
                </p>
              </div>
              <a href="/dashboard.html" class="user-menu-item">
                <i class="fas fa-tachometer-alt"></i>
                Dashboard
              </a>
              <a href="/planos.html" class="user-menu-item">
                <i class="fas fa-crown"></i>
                Planos & Assinatura
              </a>
              <div class="border-t border-gray-200 mt-1 pt-1">
                <a href="#" onclick="logout()" class="user-menu-item">
                  <i class="fas fa-sign-out-alt"></i>
                  Sair
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Hero Section -->
    <div class="relative z-1 flex flex-col justify-center px-6 pt-44 pb-32 md:pt-48 md:pb-40 min-h-screen pointer-events-none">
      <!-- Background Blur -->
      <div class="absolute top-1/2 left-1/2 w-[600px] h-[600px] -translate-x-1/2 -translate-y-1/2 bg-white opacity-5 blur-[100px] rounded-full pointer-events-none"></div>
      
      <!-- Hero Content -->
      <div class="max-w-6xl mx-auto w-full text-left">
        <h1 class="hero-title tracking-tight mb-6 pointer-events-none">
          <span class="geminii-text">Geminii Tech</span><br>
          <span class="text-white font-light hero-subtitle">Trading Automatizado</span>
        </h1>
        
        <p class="hero-description text-neutral-300 mt-6 max-w-3xl leading-relaxed pointer-events-none">
          Onde a inteligência artificial encontra estratégias de mercado 
          com visão quantitativa e automação completa para revolucionar seus investimentos.
        </p>
        
        <!-- Dynamic CTA Button -->
        <!-- Dynamic CTA Button -->
        <div class="mt-12 pointer-events-auto">
          <div id="guestCTA">
            <a href="/register.html" class="auth-btn font-semibold rounded-full transition-all duration-300 transform hover:scale-105">
              Começar Grátis
            </a>
          </div>
          
          <div id="userCTA" class="hidden">
            <a href="/dashboard.html" class="dashboard-btn font-semibold rounded-full transition-all duration-300 transform hover:scale-105">
              Acessar Dashboard
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Carrossel de Ações -->
    <div class="market-carousel">
      <div class="carousel-container" style="height: 80px;">
        <div id="carouselContent">
          <div class="loading-carousel">
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <div class="loading-dot"></div>
            <span class="ml-3">Carregando cotações...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Simples -->
    <footer class="relative z-10 bg-black bg-opacity-60 backdrop-blur-md border-t border-white border-opacity-10">
      <div class="max-w-6xl mx-auto px-6 py-12">
        <!-- Newsletter Section -->
        <div class="text-center mb-8">
          <h3 class="text-xl font-medium text-white mb-4">Fique por dentro das oportunidades</h3>
          <p class="text-neutral-300 mb-6 max-w-xl mx-auto">
            Receba análises exclusivas e insights sobre as melhores oportunidades na bolsa brasileira.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center max-w-md mx-auto">
            <input 
              id="newsletterEmail"
              type="email" 
              placeholder="Seu melhor e-mail" 
              class="newsletter-input flex-1 px-4 py-3 bg-white bg-opacity-5 border border-white border-opacity-20 rounded-full text-white placeholder-gray-400 focus:outline-none focus:border-geminii focus:bg-opacity-10 transition-all duration-300"
            >
            <button id="newsletterBtn" class="newsletter-btn px-6 py-3 bg-white text-black font-medium rounded-full hover:bg-gray-200 transition-all duration-300 shadow-lg hover:shadow-xl">
              Inscrever-se
            </button>
          </div>
        </div>

        <!-- Social Media -->
        <div class="flex justify-center gap-6 mb-8">
          <a href="#" class="social-icon" title="YouTube">
            <i class="fab fa-youtube"></i>
          </a>
          <a href="#" class="social-icon" title="Instagram">
            <i class="fab fa-instagram"></i>
          </a>
          <a href="#" class="social-icon" title="LinkedIn">
            <i class="fab fa-linkedin"></i>
          </a>
          <a href="#" class="social-icon" title="Telegram">
            <i class="fab fa-telegram"></i>
          </a>
        </div>

        <!-- Footer Links Simples -->
        <div class="flex justify-center gap-8 mb-6">
          <a href="#" class="footer-link">Termos de Uso</a>
          <a href="#" class="footer-link">Privacidade</a>
          <a href="/planos" class="footer-link">Planos</a>
          <a href="/sobre" class="footer-link">Sobre</a>
        </div>

        <!-- Copyright -->
        <div class="text-center pt-6 border-t border-white border-opacity-10">
          <p class="text-neutral-400 text-sm">
            © 2025 Todos os direitos reservados à <span style="color: #ba39af; font-weight: 500;">Geminii Research</span>
          </p>
        </div>
      </div>
    </footer>
  </div>

  <script>
    let currentUser = null;
    let userToken = null;
    let carouselUpdateInterval = null;

    // ===== CARROSSEL FUNCTIONS =====
    
    async function loadCarouselData() {
      try {
        console.log('🎠 Carregando dados do carrossel...');
        
        const response = await fetch('/api/carrossel/stocks');
        const result = await response.json();
        
        if (result.success && result.data) {
          updateCarouselDisplay(result.data);
          // ✅ COMENTAR esta linha:
          // updateMarketSummary(result.data.market_stats);
          console.log(`✅ Carrossel: ${result.data.total_stocks} ações carregadas`);
        } else {
          showCarouselError(result.error || 'Erro ao carregar dados');
        }
        
      } catch (error) {
        console.error('❌ Erro no carrossel:', error);
        showCarouselError('Conexão indisponível');
      }
    }

    function updateCarouselDisplay(data) {
      const container = document.getElementById('carouselContent');
      
      if (!data.stocks || data.stocks.length === 0) {
        container.innerHTML = `
          <div class="loading-carousel">
            <i class="fas fa-exclamation-triangle text-yellow-500"></i>
            <span class="ml-2">Nenhuma cotação disponível</span>
          </div>
        `;
        return;
      }

      // Duplicar array para efeito de loop infinito
      const stocks = [...data.stocks, ...data.stocks];
      
      const carouselHTML = `
        <div class="carousel-track">
          ${stocks.map(stock => `
            <div class="stock-item ${getStockClass(stock.change_percent)}" 
                 onclick="showStockDetails('${stock.symbol}')" 
                 title="Clique para mais detalhes">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-geminii to-purple-600 flex items-center justify-center text-white text-xs font-bold">
                  ${stock.symbol.substring(0, 2)}
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="font-semibold text-white text-sm">${stock.symbol}</span>
                    <span class="text-xs text-gray-400 truncate max-w-[80px]" title="${stock.name}">
                      ${stock.name.length > 12 ? stock.name.substring(0, 12) + '...' : stock.name}
                    </span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="font-bold text-white">R$ ${stock.price}</span>
                    <span class="text-xs ${getChangeColor(stock.change_percent)} font-medium">
                      ${stock.change_percent >= 0 ? '+' : ''}${stock.change_percent.toFixed(2)}%
                    </span>
                  </div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-gray-400">Vol</div>
                  <div class="text-xs text-white">${formatVolume(stock.volume)}</div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      `;
      
      container.innerHTML = carouselHTML;
    }

    function updateMarketSummary(stats) {
      if (!stats) return;
      /*
      document.getElementById('marketPositive').textContent = `${stats.positive} ↗️`;
      document.getElementById('marketNegative').textContent = `${stats.negative} ↘️`;
      document.getElementById('marketNeutral').textContent = `${stats.neutral} ➡️`;
      ocument.getElementById('marketUpdate').textContent = `Atualizado às ${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}`;
      const refreshIcon = document.getElementById('refreshIcon');
      refreshIcon.classList.remove('animate-spin');
      setTimeout(() => refreshIcon.classList.add('animate-spin'), 100);
      */
    }

    function showCarouselError(error) {
      const container = document.getElementById('carouselContent');
      container.innerHTML = `
        <div class="loading-carousel">
          <i class="fas fa-exclamation-triangle text-red-500"></i>
          <span class="ml-2 text-red-400">${error}</span>
          <button onclick="loadCarouselData()" class="ml-3 text-geminii hover:text-purple-400 underline">
            Tentar novamente
          </button>
        </div>
      `;
    }

    function getStockClass(changePercent) {
      if (changePercent > 0.1) return 'stock-positive';
      if (changePercent < -0.1) return 'stock-negative';
      return 'stock-neutral';
    }

    function getChangeColor(changePercent) {
      if (changePercent > 0.1) return 'text-green-400';
      if (changePercent < -0.1) return 'text-red-400';
      return 'text-gray-400';
    }

    function formatVolume(volume) {
      if (volume >= 1000000) {
        return (volume / 1000000).toFixed(1) + 'M';
      } else if (volume >= 1000) {
        return (volume / 1000).toFixed(0) + 'K';
      }
      return volume.toString();
    }

    function showStockDetails(symbol) {
      // Implementar modal ou redirecionamento para detalhes da ação
      alert(`📊 ${symbol}\n\nDetalhes da ação em desenvolvimento...\n\nEm breve você poderá ver:\n• Gráficos avançados\n• Análise técnica\n• Recomendações IA`);
    }

    async function refreshCarousel() {
      const refreshIcon = document.getElementById('refreshIcon');
      refreshIcon.classList.add('animate-spin');
      await loadCarouselData();
    }

    // ===== ORIGINAL FUNCTIONS =====

    // Navigation
    function navigateHome() {
      window.location.href = '/';
    }

    // Auth functions
    async function checkAuthStatus() {
      const token = localStorage.getItem('geminii_token');
      const userData = localStorage.getItem('geminii_user');

      if (!token || !userData) {
        showGuestView();
        return;
      }

      try {
        const response = await fetch('/api/auth/verify', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        const result = await response.json();

        if (result.success) {
          userToken = token;
          currentUser = result.data.user;
          showUserView(currentUser);
        } else {
          localStorage.removeItem('geminii_token');
          localStorage.removeItem('geminii_user');
          showGuestView();
        }

      } catch (error) {
        localStorage.removeItem('geminii_token');
        localStorage.removeItem('geminii_user');
        showGuestView();
      }
    }

    function showGuestView() {
      document.getElementById('guestView').classList.remove('hidden');
      document.getElementById('userView').classList.add('hidden');
      document.getElementById('guestCTA').classList.remove('hidden');
      document.getElementById('userCTA').classList.add('hidden');
      
      currentUser = null;
      userToken = null;
    }

    function showUserView(user) {
      document.getElementById('guestView').classList.add('hidden');
      document.getElementById('userView').classList.remove('hidden');
      document.getElementById('guestCTA').classList.add('hidden');
      document.getElementById('userCTA').classList.remove('hidden');

      const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
      document.getElementById('userInitials').textContent = initials;
      document.getElementById('userName').textContent = user.name;
      document.getElementById('userEmail').textContent = user.email;
      document.getElementById('userPlan').textContent = user.plan_name || 'Básico';

      const planBadge = document.getElementById('planBadge');
      const planId = user.plan_id || 1;
      
      if (planId === 1) {
        planBadge.textContent = 'Pro';
        planBadge.className = 'plan-badge Premium';
      } else if (planId === 2) {
        planBadge.textContent = 'Premium';
        planBadge.className = 'plan-badge strategic';
      } else if (planId >= 3) {
        planBadge.textContent = 'Grátis';
        planBadge.className = 'plan-badge';
      }
    }
    
    function toggleUserMenu() {
      const userMenu = document.querySelector('.user-menu');
      userMenu.classList.toggle('active');
    }

    async function logout() {
      try {
        if (userToken) {
          await fetch('/api/auth/logout', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${userToken}`
            }
          });
        }
      } catch (error) {
        console.error('Logout error:', error);
      } finally {
        localStorage.removeItem('geminii_token');
        localStorage.removeItem('geminii_user');
        showGuestView();
        document.querySelector('.user-menu').classList.remove('active');
      }
    }

    // Newsletter subscription
    async function subscribeNewsletter() {
      const emailInput = document.getElementById('newsletterEmail');
      const newsletterBtn = document.getElementById('newsletterBtn');
      const email = emailInput.value.trim();

      if (!email || !email.includes('@')) {
        alert('❌ Por favor, insira um e-mail válido.');
        return;
      }

      newsletterBtn.innerHTML = 'Inscrevendo...';

      try {
        const response = await fetch('/api/newsletter', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });

        const result = await response.json();

        if (result.success) {
          alert(`✅ ${result.message}\n\nVocê receberá nossas análises exclusivas em breve!`);
          emailInput.value = '';
        }
      } catch (error) {
        alert('❌ Erro ao inscrever na newsletter. Tente novamente.');
      } finally {
        newsletterBtn.innerHTML = 'Inscrever-se';
      }
    }

    // API Status check
    async function checkApiStatus() {
      try {
        const response = await fetch('/api/status');
        const data = await response.json();
        
        if (data.status === 'online') {
          document.getElementById('apiStatus').innerHTML = `
            <i class="fas fa-shield-alt text-green-500 text-xs"></i>
            <div class="absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          `;
        }
      } catch (error) {
        document.getElementById('apiStatus').innerHTML = `
          <i class="fas fa-shield-alt text-red-500 text-xs"></i>
          <div class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
        `;
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Geminii Tech - Index com Carrossel carregado!');
      
      // Newsletter subscription
      document.getElementById('newsletterBtn').addEventListener('click', subscribeNewsletter);
      
      document.getElementById('newsletterEmail').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          subscribeNewsletter();
        }
      });

      // Initialize carrossel
      loadCarouselData();
      
      // Auto-refresh carrossel a cada 60 segundos
      carouselUpdateInterval = setInterval(loadCarouselData, 60000);
      
      // Initialize outros componentes
      checkApiStatus();
      setInterval(checkApiStatus, 30000);
      checkAuthStatus();
    });

    // Global function exposure
    window.toggleUserMenu = toggleUserMenu;
    window.logout = logout;
    window.navigateHome = navigateHome;
    window.showStockDetails = showStockDetails;
    window.refreshCarousel = refreshCarousel;
    window.loadCarouselData = loadCarouselData;

    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
      if (carouselUpdateInterval) {
        clearInterval(carouselUpdateInterval);
      }
    });
  </script>
</body>
</html>